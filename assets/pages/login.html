<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Trivio</title>
    <link rel="stylesheet" href="/assets/css/login.css">
</head>
<body>

    <div class="login-container">
        <h2>Login to Trivio</h2>
        <div class="card">
            <form id="login-form">
                <label for="identifier" class="form-label">Email or Phone Number</label><br>
                <input type="text" id="identifier" name="identifier" required>
                <br><br>
                <label for="password" class="form-label">Password</label><br>
                <input type="password" id="password" name="password" required>
                <br><br>            
                <button type="submit" class="btn-primary">Login</button><br><br>
            </form>
        </div>
        <br>
        <p>Don't have an account? <a href="register.html">Register here</a></p>
    </div>

</body>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("login-form");
    const identifierInput = document.getElementById("identifier");
    const passwordInput = document.getElementById("password");

    // ✅ Validate email or phone number format
    function isValidIdentifier(input) {
        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        const phoneRegex = /^[6-9]\d{9}$/; // Assumes a 10-digit Indian phone number
        return emailRegex.test(input) || phoneRegex.test(input);
    }

    // ✅ Validate password (Min 8 chars, 1 uppercase, 1 lowercase, 1 number)
    function isValidPassword(password) {
        const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;
        return regex.test(password);
    }

    // ✅ Show error message
    function showError(input, message) {
        alert(message); // Simple alert for now (improve later with UI changes)
        input.focus();
    }

    // ✅ Form submission
    form.addEventListener("submit", function (event) {
        event.preventDefault(); // Prevent default form submission

        const identifier = identifierInput.value.trim();
        const password = passwordInput.value.trim();

        if (!isValidIdentifier(identifier)) {
            showError(identifierInput, "Please enter a valid Email or Phone Number!");
            return;
        }

        if (!isValidPassword(password)) {
            showError(passwordInput, "Password must have 8+ chars, 1 uppercase, 1 lowercase, 1 number.");
            return;
        }

        // ✅ Send login request to backend
        fetch("http://localhost:3000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ identifier, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert("✅ Login successful!");
                window.location.href = "home.html"; // Redirect to home page
            } else {
                showError(passwordInput, "❌ Incorrect Email/Phone or Password!");
            }
        })
        .catch(error => {
            console.error("Error during login:", error);
            alert("❗ Error connecting to the server.");
        });
    });
});
</script>
</html>
