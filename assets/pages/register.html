<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Trivio</title>
    <link rel="stylesheet" href="/assets/css/register.css">
</head>
<body>

<br>
    <div class="register-container">
        <h2>Create an Account</h2>
        <div class="card">
            <form action="register_process.php" method="POST">
                <div class="form-group">
                    <label for="name" class="form-label">User Name</label>
                    <input type="text" id="name" name="name" required>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-group">
                    <label for="phone" class="form-label">Phone Number</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>

                <div class="form-group">
                    <label for="dob" class="form-label">Date of Birth</label>
                    <input type="date" id="dob" name="dob" required>
                </div>

                <div class="form-group">
                    <label for="gender" class="form-label">Gender</label>
                    <select id="gender" name="gender" required>
                        <option value="">Select</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>

                <div class="form-group">
                    <label for="confirm-password" class="form-label">Confirm Password</label>
                    <input type="password" id="confirm-password" name="confirm-password" required>
                </div>

                <button type="submit" class="btn-primary">Register</button>
            </form>
        </div>
        <p>Already have an account? <a href="login.html">Login here</a></p>
    </div>
</body>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form");
    const nameInput = document.getElementById("name");
    const emailInput = document.getElementById("email");
    const phoneInput = document.getElementById("phone");
    const passwordInput = document.getElementById("password");
    const confirmPasswordInput = document.getElementById("confirm-password");

    function showError(input, message) {
        let parent = input.parentElement;
        let error = parent.querySelector(".error-message");
        
        if (!error) {
            error = document.createElement("div");
            error.className = "error-message";
            parent.appendChild(error);
        }

        error.textContent = message;
        error.style.color = "#8B0000";
        error.style.fontSize = "14px";
        error.style.marginTop = "5px";
        error.style.opacity = "1";

        input.style.border = "2px solid #8B0000";
        input.style.boxShadow = "0 0 8px rgba(139, 0, 0, 0.5)";
    }

    function clearError(input) {
        let parent = input.parentElement;
        let error = parent.querySelector(".error-message");
        
        if (error) {
            error.style.opacity = "0";
            setTimeout(() => error.remove(), 300);
        }

        input.style.border = "2px solid #8B5A2B";
        input.style.boxShadow = "none";
    }

    function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function validatePhone(phone) {
        return /^[0-9]{10}$/.test(phone);
    }

    function validatePassword(password) {
        return password.length >= 6;
    }

    emailInput.addEventListener("input", function () {
        if (!validateEmail(emailInput.value)) {
            showError(emailInput, "Invalid email format!");
        } else {
            clearError(emailInput);
        }
    });

    phoneInput.addEventListener("input", function () {
        if (!validatePhone(phoneInput.value)) {
            showError(phoneInput, "Enter a valid 10-digit phone number!");
        } else {
            clearError(phoneInput);
        }
    });

    passwordInput.addEventListener("input", function () {
        if (!validatePassword(passwordInput.value)) {
            showError(passwordInput, "Password must be at least 6 characters long!");
        } else {
            clearError(passwordInput);
        }
    });

    confirmPasswordInput.addEventListener("input", function () {
        if (confirmPasswordInput.value !== passwordInput.value) {
            showError(confirmPasswordInput, "Passwords do not match!");
        } else {
            clearError(confirmPasswordInput);
        }
    });

    form.addEventListener("submit", async function (event) {
        event.preventDefault();
        
        let hasError = false;

        if (!validateEmail(emailInput.value)) {
            showError(emailInput, "Invalid email format!");
            hasError = true;
        }

        if (!validatePhone(phoneInput.value)) {
            showError(phoneInput, "Enter a valid 10-digit phone number!");
            hasError = true;
        }

        if (!validatePassword(passwordInput.value)) {
            showError(passwordInput, "Password must be at least 6 characters long!");
            hasError = true;
        }

        if (confirmPasswordInput.value !== passwordInput.value) {
            showError(confirmPasswordInput, "Passwords do not match!");
            hasError = true;
        }

        if (hasError) return; // Stop form submission if any error exists

        // ✅ Send form data to backend for registration
        const formData = new FormData(this);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch("http://localhost:3000/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
            });

            const result = await response.json();
            alert(result.message);

            if (result.message === "✅ User registered successfully!") {
                window.location.href = "login.html"; // Redirect to login page
            }
        } catch (error) {
            console.error("❌ Error:", error);
        }
    });
});
</script>
</html>